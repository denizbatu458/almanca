<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Deutsch Lernen</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

<style>
:root{
  /* Daha aÃ§Ä±k tema */
  --bg1:#161d3f;
  --bg2:#101633;
  --panel:rgba(255,255,255,.06);
  --card:rgba(255,255,255,.08);
  --text:#f5f7ff;
  --muted:#c7d0ff;
  --border:rgba(255,255,255,.16);
  --neon:#ff4b4b;
  --neon2:#ff8a8a;
  --ok:#4be38a;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,system-ui,sans-serif;
  background:
    radial-gradient(900px 600px at 15% 15%, rgba(255,60,60,.45), transparent 60%),
    radial-gradient(900px 600px at 85% 20%, rgba(255,120,120,.35), transparent 65%),
    radial-gradient(700px 500px at 50% 90%, rgba(255,70,70,.25), transparent 70%),
    linear-gradient(180deg,#1a1022,#12081a);
  color:var(--text);
}


/* LOGIN */
.login{
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}
.login .card{
  width:380px;
  background:var(--card);
  padding:28px;
  border-radius:22px;
  border:1px solid var(--border);
  box-shadow:0 20px 60px rgba(0,0,0,.25);
}
input{
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:14px;
  border:1px solid var(--border);
  background:rgba(10,14,34,.55);
  color:#fff;
}
input:focus{border-color:rgba(255,255,255,.32)}
button{
  width:100%;
  margin-top:16px;
  padding:12px;
  border-radius:14px;
  border:none;
  background:linear-gradient(135deg,var(--neon),var(--neon2));
  color:#fff;
  font-weight:800;
  cursor:pointer;
}
.error{color:#ffb0b0;margin-top:10px}

/* APP */
.app{display:none}
header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:18px 22px;
  background:var(--panel);
  backdrop-filter:blur(12px);
  border-bottom:1px solid var(--border);
}
header strong{font-weight:800}
.sub{
  color:var(--muted);
  font-size:13px;
  margin-top:4px;
}

/* Hero */
.hero{
  max-width:900px;
  margin:34px auto 10px;
  text-align:center;
  padding:0 14px;
}
.hero h1{
  margin:0;
  font-size:32px;
  font-weight:800;
}
.hero p{color:var(--muted)}

.progressWrap{max-width:460px;margin:18px auto 0;}
.progressBar{
  height:12px;
  background:rgba(10,14,34,.55);
  border-radius:999px;
  overflow:hidden;
  border:1px solid var(--border);
}
.progressFill{
  width:0%;
  height:100%;
  background:linear-gradient(90deg,var(--neon),var(--neon2));
  box-shadow:0 0 18px rgba(255,75,75,.55);
}

.badges{
  display:flex;
  justify-content:center;
  gap:10px;
  margin:16px 0 0;
  flex-wrap:wrap;
}
.badge{
  padding:7px 14px;
  border-radius:999px;
  background:rgba(255,255,255,.10);
  border:1px solid var(--border);
  font-size:12px;
  color:var(--muted);
}

/* Cards */
.container{max-width:1020px;margin:28px auto 70px;padding:0 18px;}
.cards{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:22px;
}
.cardLink{
  width:100%;
  background:var(--card);
  padding:22px;
  border-radius:22px;
  border:1px solid var(--border);
  text-decoration:none;
  color:var(--text);
  text-align:center;
  transition:.35s;
  box-shadow:0 16px 50px rgba(0,0,0,.18);
}
.cardLink:hover{
  transform:translateY(-8px) scale(1.02);
  box-shadow:
    0 0 0 1px rgba(255,255,255,.22),
    0 25px 60px rgba(255,75,75,.25);
}
.cardLink span{
  display:block;
  margin-top:8px;
  font-size:13px;
  color:var(--muted);
}

/* Modern Ã§Ä±kÄ±ÅŸ: Ã¼stte deÄŸil, saÄŸ altta */
.fabRow{
  position:fixed;
  right:18px;
  bottom:18px;
  display:flex;
  gap:10px;
  z-index:99;
}
.fab{
  display:flex;
  align-items:center;
  gap:10px;
  padding:12px 14px;
  border-radius:999px;
  background:rgba(255,255,255,.10);
  border:1px solid var(--border);
  color:var(--text);
  cursor:pointer;
  backdrop-filter:blur(10px);
  box-shadow:0 18px 55px rgba(0,0,0,.25);
}
.fab:hover{border-color:rgba(255,255,255,.30)}
.fabDot{
  width:10px;height:10px;border-radius:50%;
  background:linear-gradient(135deg,var(--neon),var(--neon2));
  box-shadow:0 0 18px rgba(255,75,75,.55);
}

/* Bildirim kÃ¶ÅŸesi */
.notifCount{
  min-width:22px;
  height:22px;
  padding:0 6px;
  border-radius:999px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  background:linear-gradient(135deg,var(--neon),var(--neon2));
  color:#fff;
  font-size:12px;
  font-weight:800;
}

/* Modal */
.modalBack{
  position:fixed; inset:0;
  background:rgba(0,0,0,.55);
  display:none;
  align-items:center;
  justify-content:center;
  padding:18px;
  z-index:100;
}
.modal{
  width:min(720px,100%);
  background:rgba(255,255,255,.08);
  border:1px solid var(--border);
  border-radius:20px;
  backdrop-filter:blur(14px);
  box-shadow:0 30px 90px rgba(0,0,0,.35);
  overflow:hidden;
}
.modalHead{
  padding:16px 18px;
  border-bottom:1px solid var(--border);
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.modalBody{padding:16px 18px; max-height:60vh; overflow:auto;}
.replyCard{
  padding:12px 12px;
  border-radius:16px;
  border:1px solid var(--border);
  background:rgba(10,14,34,.45);
  margin-bottom:12px;
}
.replyCard small{color:var(--muted)}
.modalBtn{
  border:1px solid var(--border);
  background:transparent;
  color:var(--muted);
  border-radius:12px;
  padding:8px 10px;
  cursor:pointer;
}
.modalBtn:hover{border-color:rgba(255,255,255,.28); color:#fff}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="login" id="login">
  <div class="card">
    <h2>Ã–ÄŸrenci GiriÅŸi</h2>
    <input id="u" placeholder="KullanÄ±cÄ± adÄ±">
    <input id="p" type="password" placeholder="Åifre">
    <div class="error" id="err"></div>
    <button onclick="login()">GiriÅŸ Yap</button>
  </div>
</div>

<!-- APP -->
<div class="app" id="app">

<header>
  <div>
    <strong id="welcome">HoÅŸgeldin</strong>
    <div class="sub" id="subline">Almanca Ã¶ÄŸrenmeye devam!</div>
  </div>
  <div style="color:var(--muted);font-size:13px;">Deutsch Lernen</div>
</header>

<section class="hero">
  <h1>Deutsch Lernen</h1>
  <p>Modern â€¢ Disiplinli â€¢ Etkili Almanca Ã–ÄŸrenme</p>

  <div class="progressWrap">
    <div class="progressBar">
      <div class="progressFill" id="progressFill"></div>
    </div>
    <div style="color:var(--muted);font-size:12px;margin-top:8px;" id="progressText">Ä°lerleme: %0</div>
  </div>

  <div class="badges" id="badges"></div>
</section>

<div class="container">
  <div class="cards">
    <a href="dersler.html" class="cardLink">ğŸ“˜ Dersler<span>Lektionen</span></a>
    <a href="alistirma.html" class="cardLink">âœï¸ AlÄ±ÅŸtÄ±rmalar<span>Ãœbungen</span></a>
    <a href="diziler.html" class="cardLink">ğŸ¬ Mini Dizi<span>Dialoge</span></a>
    <a href="kelimeler.html" class="cardLink">ğŸ“š Kelimeler<span>Wortschatz</span></a>
    <a href="asistan.html" class="cardLink">ğŸ§  Asistan<span>Lernhilfe</span></a>
    <a href="mesaj.html" class="cardLink">âœ‰ï¸ Ã–ÄŸretmene Mesaj</a>
    <a href="analiz.html" class="cardLink">ğŸ“Š Analiz & SonuÃ§lar<span>BaÅŸarÄ± â€¢ Grafik â€¢ Ä°statistik</span>
</a>
  </div>
</div>

</div>

<!-- Floating actions: Bildirim + Ã‡Ä±kÄ±ÅŸ -->
<div class="fabRow">
  <button class="fab" type="button" onclick="openReplies()" aria-label="Bildirimler">
    <span class="fabDot"></span>
    <span style="font-weight:800;">Bildirimler</span>
    <span class="notifCount" id="notifCount" style="display:none;">0</span>
  </button>

  <button class="fab" type="button" onclick="logout()" aria-label="Ã‡Ä±kÄ±ÅŸ Yap">
    <span class="fabDot"></span>
    <span style="font-weight:800;">Oturumu Kapat</span>
  </button>
</div>

<!-- Replies Modal -->
<div class="modalBack" id="modalBack" onclick="closeReplies(event)">
  <div class="modal" role="dialog" aria-modal="true" onclick="event.stopPropagation()">
    <div class="modalHead">
      <strong>ğŸ“© Ã–ÄŸretmen CevaplarÄ±</strong>
      <button class="modalBtn" type="button" onclick="closeReplies()">Kapat</button>
    </div>
    <div class="modalBody" id="replyList"></div>
    <div style="padding:0 18px 16px;">
      <button class="modalBtn" type="button" onclick="markAllRead()">TÃ¼mÃ¼nÃ¼ Okundu Yap</button>
    </div>
  </div>
</div>

<script>
/* Ã‡ALIÅAN JS â€“ login/session bozulmadÄ± */
const KEY_STUDENTS="students_v2";
const KEY_SESSION="session_student_id";

/* âœ… yeni: progress + replies */
const KEY_PROGRESS="student_progress_v1";
const KEY_REPLIES="teacher_replies_v1";

const loginBox=document.getElementById("login");
const appBox=document.getElementById("app");
const err=document.getElementById("err");
const welcome=document.getElementById("welcome");
const subline=document.getElementById("subline");

function getStudents(){
  try{return JSON.parse(localStorage.getItem(KEY_STUDENTS))||[]}catch{return[]}
}
function getSession(){
  const id=localStorage.getItem(KEY_SESSION);
  return getStudents().find(s=>String(s.id)===String(id));
}
function showApp(s){
  loginBox.style.display="none";
  appBox.style.display="block";
  welcome.textContent="HoÅŸgeldin, "+s.name;

  // Dinamik rozet + progress
  applyProgressAndBadges(s);

  // Bildirim sayacÄ±
  updateNotifCount(s);
}
function showLogin(){
  appBox.style.display="none";
  loginBox.style.display="flex";
}
const student=getSession();
student?showApp(student):showLogin();

function login(){
  err.textContent="";
  const u=document.getElementById("u").value.trim().toLowerCase();
  const p=document.getElementById("p").value.trim();
  const s=getStudents().find(x=>x.username===u&&x.password===p);
  if(!s){err.textContent="Bilgiler hatalÄ±";return}
  localStorage.setItem(KEY_SESSION,s.id);
  showApp(s);
}
function logout(){
  localStorage.removeItem(KEY_SESSION);
  showLogin();
}

/* âœ… Progress + badges */
function getProgressMap(){
  try { return JSON.parse(localStorage.getItem(KEY_PROGRESS)) || {}; }
  catch { return {}; }
}
function setProgress(studentId, val){
  const map = getProgressMap();
  map[String(studentId)] = Math.max(0, Math.min(100, Number(val)||0));
  localStorage.setItem(KEY_PROGRESS, JSON.stringify(map));
}
function getProgress(studentId){
  const map = getProgressMap();
  const v = map[String(studentId)];
  return (typeof v === "number") ? v : 0;
}
function applyProgressAndBadges(s){
  const p = getProgress(s.id); // varsayÄ±lan 0
  document.getElementById("progressFill").style.width = p + "%";
  document.getElementById("progressText").textContent = "Ä°lerleme: %" + p;

  const b = document.getElementById("badges");
  b.innerHTML = "";

  // Seviye rozeti
  b.appendChild(makeBadge("ğŸ“˜ Seviye: " + (s.level || "A1")));

  // Ä°lerleme rozetleri
  if(p < 10){
    b.appendChild(makeBadge("ğŸ¯ BaÅŸlangÄ±Ã§"));
    subline.textContent = "BugÃ¼n 10 dakika bile yeter!";
  } else if(p < 40){
    b.appendChild(makeBadge("ğŸ”¥ IsÄ±nÄ±yor"));
    subline.textContent = "GÃ¼zel gidiyorsun, devam!";
  } else if(p < 70){
    b.appendChild(makeBadge("ğŸš€ Ä°stikrarlÄ±"));
    subline.textContent = "Tempo Ã§ok iyi!";
  } else {
    b.appendChild(makeBadge("ğŸ† Ã‡ok Ä°yi"));
    subline.textContent = "Harika! Bitirmeye yaklaÅŸtÄ±n.";
  }

  // Motivasyon rozeti (level'e gÃ¶re)
  const lv = (s.level || "A1").toUpperCase();
  const map = {
    "A1":"ğŸŸ¢ Temel",
    "A2":"ğŸŸ¡ GeliÅŸen",
    "B1":"ğŸŸ  Orta",
    "B2":"ğŸ”µ Ä°leri",
    "C1":"ğŸŸ£ Akademik",
    "C2":"âš« Usta"
  };
  b.appendChild(makeBadge(map[lv] || "ğŸ“Œ Hedef"));
}
function makeBadge(text){
  const d = document.createElement("div");
  d.className = "badge";
  d.textContent = text;
  return d;
}

/* âœ… Bildirim / cevaplar */
function getReplies(){
  try { return JSON.parse(localStorage.getItem(KEY_REPLIES)) || []; }
  catch { return []; }
}
function saveReplies(arr){
  localStorage.setItem(KEY_REPLIES, JSON.stringify(arr));
}
function getMyReplies(s){
  const key1 = String(s.id);
  const key2 = String(s.username || "");
  return getReplies().filter(r => String(r.studentKey)===key1 || String(r.studentKey)===key2);
}
function unreadCount(s){
  return getMyReplies(s).filter(r => !r.read).length;
}
function updateNotifCount(s){
  const c = unreadCount(s);
  const el = document.getElementById("notifCount");
  if(c>0){
    el.style.display="inline-flex";
    el.textContent = c;
  } else {
    el.style.display="none";
  }
}

function openReplies(){
  const s = getSession();
  if(!s){ return; }
  const back = document.getElementById("modalBack");
  const list = document.getElementById("replyList");
  list.innerHTML = "";

  const items = getMyReplies(s).slice().reverse();
  if(!items.length){
    list.innerHTML = `<div style="color:var(--muted)">HenÃ¼z Ã¶ÄŸretmen cevabÄ± yok.</div>`;
  } else {
    items.forEach(r=>{
      const card = document.createElement("div");
      card.className = "replyCard";
      card.innerHTML = `
        <div style="display:flex;justify-content:space-between;gap:10px;align-items:center;">
          <strong>${escapeHtml(r.text || "")}</strong>
          <span style="color:var(--muted);font-size:12px;">${escapeHtml(r.date || "")}</span>
        </div>
        <small>${r.read ? "Okundu" : "Yeni âœ…"}</small>
      `;
      list.appendChild(card);
    });
  }

  back.style.display="flex";

  // Modal aÃ§Ä±nca: hepsini okundu yapmayÄ± otomatik istemedim, buton var.
}
function closeReplies(e){
  document.getElementById("modalBack").style.display="none";
  const s = getSession();
  if(s) updateNotifCount(s);
}
function markAllRead(){
  const s = getSession();
  if(!s) return;
  const all = getReplies();
  const my = getMyReplies(s);

  const myIds = new Set(my.map(x=>String(x.id)));
  const updated = all.map(r => myIds.has(String(r.id)) ? ({...r, read:true}) : r);
  saveReplies(updated);

  openReplies(); // yeniden render
  updateNotifCount(s);
}

function escapeHtml(s){
  return String(s||"")
    .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
    .replaceAll('"',"&quot;").replaceAll("'","&#039;");
}

/* Ä°stersen test amaÃ§lÄ± ilerleme ayarÄ±:
   Konsolda Ã§alÄ±ÅŸtÄ±r: setProgress(studentId, 35)
*/
</script>

</body>
</html>
