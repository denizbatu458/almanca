<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Penumbra | Performans Analizi</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #020617;
  --panel: #0f172a;
  --card: rgba(30, 41, 59, 0.5);
  --border: rgba(255, 255, 255, 0.1);
  --text: #f8fafc;
  --muted: #94a3b8;
  --accent: #ff4b4b;
  --ok: #10b981;
  --info: #3b82f6;
  --neon-glow: 0 0 20px rgba(255, 75, 75, 0.2);
}

* { box-sizing: border-box; transition: all 0.3s ease; }
body {
  margin: 0;
  font-family: 'Inter', sans-serif;
  background: radial-gradient(circle at top right, #1e293b, #020617);
  color: var(--text);
  min-height: 100vh;
}

header {
  padding: 20px 30px;
  background: rgba(15, 23, 42, 0.8);
  backdrop-filter: blur(15px);
  border-bottom: 1px solid var(--border);
  display: flex; justify-content: space-between; align-items: center;
  position: sticky; top: 0; z-index: 100;
}

.container { max-width: 1000px; margin: 40px auto; padding: 0 20px; }

/* Ã–zet KartlarÄ± */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px; margin-bottom: 40px;
}
.stat-box {
  background: var(--card); border: 1px solid var(--border);
  padding: 25px; border-radius: 24px; text-align: center;
  position: relative; overflow: hidden;
}
.stat-box::before {
    content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 4px; background: var(--accent); opacity: 0;
}
.stat-box:hover::before { opacity: 1; }
.stat-box:hover { transform: translateY(-5px); border-color: rgba(255,255,255,0.2); }
.stat-val { display: block; font-size: 38px; font-weight: 800; color: #fff; }
.stat-label { color: var(--muted); font-size: 11px; text-transform: uppercase; letter-spacing: 1.5px; margin-top: 8px; }

/* ROZETLER */
.badge-section-title { font-size: 14px; color: var(--accent); letter-spacing: 2px; text-transform: uppercase; margin-bottom: 20px; font-weight: 800; }

.badges-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
  gap: 15px; margin-bottom: 50px;
}

/* Standart Rozet KartÄ± */
.badge-card {
  background: rgba(15, 23, 42, 0.6); border: 1px solid var(--border);
  border-radius: 24px; padding: 25px 15px; text-align: center;
  opacity: 0.3; filter: grayscale(1);
}
.badge-card.unlocked {
  opacity: 1; filter: grayscale(0); border-color: var(--ok);
  background: linear-gradient(145deg, rgba(16, 185, 129, 0.1), transparent);
  box-shadow: 0 10px 25px rgba(0,0,0,0.3);
}

/* Ã–ÄRETMEN ROZETÄ° (Ã–ZEL) */
.badge-card.special {
    opacity: 1; filter: grayscale(0);
    border: 2px solid var(--info);
    background: linear-gradient(145deg, rgba(59, 130, 246, 0.2), rgba(2, 6, 23, 0.8));
    box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
    animation: pulse-blue 2s infinite;
}
@keyframes pulse-blue {
    0% { box-shadow: 0 0 10px rgba(59, 130, 246, 0.2); }
    50% { box-shadow: 0 0 25px rgba(59, 130, 246, 0.4); }
    100% { box-shadow: 0 0 10px rgba(59, 130, 246, 0.2); }
}

.badge-icon { font-size: 44px; display: block; margin-bottom: 12px; }
.badge-name { display: block; font-size: 14px; font-weight: 800; color: #fff; }
.badge-desc { display: block; font-size: 10px; color: var(--muted); margin-top: 6px; line-height: 1.3; }

/* ANALÄ°Z Ã‡UBUKLARI */
.unit-card {
  background: var(--card); border: 1px solid var(--border);
  border-radius: 24px; padding: 25px; margin-bottom: 20px;
}
.progress-container {
  height: 14px; background: #000; border-radius: 20px;
  overflow: hidden; display: flex; margin: 15px 0; border: 1px solid var(--border);
}
.bar-fill { height: 100%; }
.bar-correct { background: linear-gradient(90deg, var(--ok), #34d399); box-shadow: 0 0 15px rgba(16, 185, 129, 0.3); }
.bar-wrong { background: #334155; }

.btn-back {
  background: var(--panel); border: 1px solid var(--border); color: white;
  padding: 12px 24px; border-radius: 16px; cursor: pointer; font-weight: 700;
}
.btn-back:hover { background: var(--accent); transform: scale(1.05); }

.empty-state { text-align: center; padding: 80px; background: var(--card); border-radius: 30px; border: 1px dashed var(--border); }
</style>
</head>
<body>

<header>
  <div style="display:flex; align-items:center; gap:12px;">
    <div style="background:var(--accent); width:40px; height:40px; border-radius:12px; display:flex; align-items:center; justify-content:center; font-size:20px;">ğŸ“Š</div>
    <strong style="font-size:20px;">BaÅŸarÄ± Analizi</strong>
  </div>
  <button class="btn-back" onclick="location.href='index.html'">Dashboard'a DÃ¶n</button>
</header>

<div class="container">
  <div class="stats-grid">
    <div class="stat-box">
      <span class="stat-val" id="totalSolved">0</span>
      <span class="stat-label">Ã‡Ã¶zÃ¼len Soru</span>
    </div>
    <div class="stat-box">
      <span class="stat-val" id="totalCorrect" style="color:var(--ok)">0</span>
      <span class="stat-label">DoÄŸru Cevap</span>
    </div>
    <div class="stat-box">
      <span class="stat-val" id="avgSuccess" style="color:var(--info)">%0</span>
      <span class="stat-label">BaÅŸarÄ± PuanÄ±</span>
    </div>
  </div>

  <div class="badge-section-title">âœ¨ KAZANILAN ROZETLER</div>
  <div class="badges-grid" id="badgeContainer"></div>

  <div class="badge-section-title">ğŸ“Š ÃœNÄ°TE ANALÄ°ZLERÄ°</div>
  <div id="unitStatsArea"></div>
</div>

<script>
// LocalStorage AnahtarlarÄ±
const KEY_RESULTS = "practice_results";
const KEY_DONE = "practice_done"; // Admin'den gelen ilerleme verisi
const KEY_STUDENT_BADGES = "manual_badges"; // Admin'den gelen rozetler

function renderAnalysis() {
  const sessId = localStorage.getItem("session_student_id");
  if (!sessId) { location.href = "index.html"; return; }

  const allResults = JSON.parse(localStorage.getItem(KEY_RESULTS)) || [];
  const myResults = allResults.filter(r => String(r.studentId) === String(sessId));
  
  // 1. Ä°STATÄ°STÄ°KLERÄ° HESAPLA
  let totalS = myResults.length;
  let totalC = myResults.filter(r => r.correct).length;
  let successRate = totalS > 0 ? Math.round((totalC / totalS) * 100) : 0;

  document.getElementById("totalSolved").textContent = totalS;
  document.getElementById("totalCorrect").textContent = totalC;
  document.getElementById("avgSuccess").textContent = "%" + successRate;

  // 2. ROZETLERÄ° GÃœNCELLE
  const badgeContainer = document.getElementById("badgeContainer");
  badgeContainer.innerHTML = "";

  // A. Admin'den Gelen Ã–zel Rozetler
  const manualBadges = JSON.parse(localStorage.getItem(KEY_STUDENT_BADGES)) || {};
  const mySpecialBadges = manualBadges[sessId] || [];

  mySpecialBadges.forEach(bStr => {
      const parts = bStr.split(" ");
      const icon = parts[0];
      const name = parts.slice(1).join(" ");
      badgeContainer.innerHTML += `
        <div class="badge-card special">
            <span class="badge-icon">${icon}</span>
            <span class="badge-name">${name}</span>
            <span class="badge-desc">Ã–ÄŸretmeninden Ã–zel BaÅŸarÄ± Ã–dÃ¼lÃ¼</span>
        </div>`;
  });

  // B. Sistemin Otomatik Rozetleri
  const systemBadges = [
    { name: 'Ä°lk AdÄ±m', desc: '1 Soru Ã‡Ã¶zÃ¼ldÃ¼', icon: 'ğŸ£', check: () => totalS >= 1 },
    { name: 'Keskin GÃ¶z', desc: '%90+ BaÅŸarÄ± (20+ Soru)', icon: 'ğŸ¯', check: () => successRate >= 90 && totalS >= 20 },
    { name: 'Yolcu', desc: '50 Soru Ã‡Ã¶zÃ¼ldÃ¼', icon: 'ğŸš²', check: () => totalS >= 50 },
    { name: 'Bilgin', desc: '200 Soru Ã‡Ã¶zÃ¼ldÃ¼', icon: 'ğŸ§™â€â™‚ï¸', check: () => totalS >= 200 },
    { name: 'Hata AvcÄ±sÄ±', desc: '10 YanlÄ±ÅŸtan Ders Ã‡Ä±kar', icon: 'ğŸ› ï¸', check: () => (totalS - totalC) >= 10 }
  ];

  systemBadges.forEach(b => {
    const isUnlocked = b.check();
    badgeContainer.innerHTML += `
      <div class="badge-card ${isUnlocked ? 'unlocked' : ''}">
        <span class="badge-icon">${b.icon}</span>
        <span class="badge-name">${b.name}</span>
        <span class="badge-desc">${b.desc}</span>
      </div>`;
  });

  // 3. ÃœNÄ°TE ANALÄ°ZLERÄ°
  const unitStatsArea = document.getElementById("unitStatsArea");
  if (totalS === 0) {
    unitStatsArea.innerHTML = '<div class="empty-state">HenÃ¼z analiz edilecek veri bulunmuyor. AlÄ±ÅŸtÄ±rma Ã§Ã¶zmeye baÅŸla!</div>';
    return;
  }

  const unitMap = {};
  myResults.forEach(r => {
    if(!unitMap[r.unit]) unitMap[r.unit] = { s:0, c:0 };
    unitMap[r.unit].s++;
    if(r.correct) unitMap[r.unit].c++;
  });

  unitStatsArea.innerHTML = "";
  for (let unit in unitMap) {
    const d = unitMap[unit];
    const p = Math.round((d.c / d.s) * 100);
    unitStatsArea.innerHTML += `
      <div class="unit-card">
        <div style="display:flex; justify-content:space-between; align-items:center">
          <strong style="font-size:16px; color:#fff">${unit}</strong> 
          <span style="color:${p > 70 ? 'var(--ok)' : 'var(--accent)'}; font-weight:800; font-size:14px;">%${p} BaÅŸarÄ±</span>
        </div>
        <div class="progress-container">
          <div class="bar-fill bar-correct" style="width:${p}%"></div>
          <div class="bar-fill bar-wrong" style="width:${100-p}%"></div>
        </div>
        <div style="display:flex; justify-content:space-between; font-size:11px; color:var(--muted); text-transform:uppercase; letter-spacing:1px;">
            <span>âœ… ${d.c} DOÄRU</span>
            <span>âŒ ${d.s - d.c} YANLIÅ</span>
            <span>ğŸ“ TOPLAM ${d.s}</span>
        </div>
      </div>`;
  }
}

// BaÅŸlat
renderAnalysis();
</script>
</body>
</html>