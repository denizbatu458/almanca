<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Analiz & SonuÃ§lar</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

<style>
:root{
  --ok:#4be38a;
  --mid:#ffd166;
  --bad:#ff6b6b;
  --muted:#c7d0ff;
}
body{
  margin:0;
  font-family:Inter,sans-serif;
  background:linear-gradient(180deg,#1a1022,#12081a);
  color:#fff;
}
header{
  padding:18px 22px;
  background:rgba(255,255,255,.06);
  border-bottom:1px solid rgba(255,255,255,.16);
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.printBtn{
  padding:8px 14px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.25);
  background:transparent;
  color:#fff;
  cursor:pointer;
}
.container{
  max-width:980px;
  margin:36px auto;
  padding:0 18px;
}
.card{
  background:rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.16);
  border-radius:22px;
  padding:22px;
  margin-bottom:28px;
}
h3{margin-top:0}
.sub{color:var(--muted);font-size:13px;margin-bottom:10px}

/* GRAPH */
.graphTitle{display:flex;justify-content:space-between;font-size:14px;margin-bottom:6px}
.bar{
  height:14px;
  background:rgba(255,255,255,.1);
  border-radius:999px;
  overflow:hidden;
  display:flex;
}
.barGood{background:linear-gradient(90deg,#4be38a,#7dffb3)}
.barMid{background:linear-gradient(90deg,#ffd166,#ffe29a)}
.barBad{background:linear-gradient(90deg,#ff6b6b,#ff9a9a)}
.unitRow{padding:14px 0;border-top:1px solid rgba(255,255,255,.12)}
.unitRow:first-child{border-top:none}
.stats{display:flex;gap:18px;font-size:13px;flex-wrap:wrap}
.stats span{color:var(--muted)}

/* BADGES */
.badges{display:flex;gap:10px;flex-wrap:wrap}
.badge{
  padding:7px 14px;
  border-radius:999px;
  background:rgba(255,255,255,.12);
  border:1px solid rgba(255,255,255,.18);
  font-size:12px;
}
.doneBadge{
  background:rgba(75,227,138,.18);
  border-color:rgba(75,227,138,.45);
}

/* SUGGESTIONS */
.suggest{
  padding:12px 14px;
  border-radius:14px;
  margin-bottom:12px;
  border:1px solid;
  font-size:14px;
}
.suggest.bad{background:rgba(255,107,107,.15);border-color:rgba(255,107,107,.5)}
.suggest.mid{background:rgba(255,209,102,.15);border-color:rgba(255,209,102,.5)}
.suggest.ok{background:rgba(75,227,138,.15);border-color:rgba(75,227,138,.5)}

/* PRINT */
@media print{
  body{background:#fff;color:#000}
  header,.printBtn{display:none}
  .card{background:#fff;border:1px solid #ddd}
  .bar{background:#eee}
}
</style>
</head>

<body>

<header>
  <strong>ğŸ“„ Analiz & SonuÃ§lar</strong>
  <button class="printBtn" onclick="printPDF()">ğŸ“¥ PDF Olarak Ä°ndir</button>
</header>

<div class="container">

  <div class="card">
    <h3>ğŸ‘¤ Ã–ÄŸrenci Bilgisi</h3>
    <div id="studentInfo"></div>
  </div>

  <div class="card">
    <h3>ğŸ… Sahip OlduÄŸun Rozetler</h3>
    <div class="badges" id="badges"></div>
  </div>

  <div class="card">
    <h3>ğŸ§  Ã‡alÄ±ÅŸma Ã–nerileri</h3>
    <div class="sub">Sistem senin yerine hangi Ã¼niteyi tekrar etmen gerektiÄŸini sÃ¶ylÃ¼yor</div>
    <div id="suggestions"></div>
  </div>

  <div class="card">
    <h3>ğŸ“ˆ Ãœnite BazlÄ± Performans</h3>
    <div id="unitStats"></div>
  </div>

  <div class="card">
    <h3>âœ”ï¸ Tamamlanan Ãœniteler</h3>
    <div class="badges" id="doneUnits"></div>
  </div>

</div>

<script>
const KEY_SESSION="session_student_id";
const KEY_UNIT_STATS="unit_stats_v1";
const KEY_DONE="completed_units_v1";
const KEY_PROGRESS="student_progress_v1";
const KEY_STUDENTS="students_v2";

function getStudent(){
  const id=localStorage.getItem(KEY_SESSION);
  const arr=JSON.parse(localStorage.getItem(KEY_STUDENTS))||[];
  return arr.find(s=>String(s.id)===String(id));
}

function studentInfoRender(s){
  const p=(JSON.parse(localStorage.getItem(KEY_PROGRESS))||{})[s.id]||0;
  studentInfo.innerHTML=`<b>${s.name}</b><br>Seviye: ${s.level||"A1"}<br>Genel Ä°lerleme: %${p}`;
}

/* BADGES */
function renderBadges(s){
  const p=(JSON.parse(localStorage.getItem(KEY_PROGRESS))||{})[s.id]||0;
  badges.innerHTML="";
  badges.appendChild(b("ğŸ“˜ Seviye: "+(s.level||"A1")));
  if(p<10) badges.appendChild(b("ğŸ¯ BaÅŸlangÄ±Ã§"));
  else if(p<40) badges.appendChild(b("ğŸ”¥ IsÄ±nÄ±yor"));
  else if(p<70) badges.appendChild(b("ğŸš€ Ä°stikrarlÄ±"));
  else badges.appendChild(b("ğŸ† Ã‡ok Ä°yi"));
}
function b(t){const d=document.createElement("div");d.className="badge";d.textContent=t;return d}

/* ANALYSIS + SUGGEST */
function renderUnitsAndSuggest(s){
  const stats=(JSON.parse(localStorage.getItem(KEY_UNIT_STATS))||{})[s.id]||{};
  const units=Object.keys(stats);
  if(!units.length){
    unitStats.innerHTML="<div class='sub'>HenÃ¼z veri yok.</div>";
    suggestions.innerHTML="<div class='sub'>Ã–neri Ã¼retmek iÃ§in veri yok.</div>";
    return;
  }

  units.forEach(u=>{
    const st=stats[u];
    const c=st.c||0,t=st.t||0,w=t-c;
    const pc=Math.round((c/t)*100)||0;

    // SUGGESTION
    if(pc<50){
      suggestions.innerHTML+=`<div class="suggest bad">ğŸ”´ <b>${u}</b> Ã¼nitesi mutlaka tekrar edilmeli.</div>`;
    }else if(pc<70){
      suggestions.innerHTML+=`<div class="suggest mid">ğŸŸ¡ <b>${u}</b> Ã¼nitesinde eksikler var, tekrar Ã¶nerilir.</div>`;
    }else{
      suggestions.innerHTML+=`<div class="suggest ok">ğŸŸ¢ <b>${u}</b> Ã¼nitesi baÅŸarÄ±lÄ±.</div>`;
    }

    // UNIT GRAPH
    const row=document.createElement("div");
    row.className="unitRow";
    row.innerHTML=`
      <div class="graphTitle">
        <strong>${u}</strong><span>%${pc}</span>
      </div>
      <div class="bar">
        <div class="barGood" style="width:${pc}%"></div>
        <div class="barBad" style="width:${100-pc}%"></div>
      </div>
      <div class="stats">
        <span>âœ”ï¸ DoÄŸru: ${c}</span>
        <span>âŒ YanlÄ±ÅŸ: ${w}</span>
        <span>ğŸ“Š Toplam: ${t}</span>
      </div>
    `;
    unitStats.appendChild(row);
  });
}

/* DONE */
function renderDone(s){
  const arr=(JSON.parse(localStorage.getItem(KEY_DONE))||{})[s.id]||[];
  doneUnits.innerHTML=arr.length
    ? arr.map(u=>`<div class="badge doneBadge">âœ”ï¸ ${u}</div>`).join("")
    : "<div class='sub'>HenÃ¼z yok.</div>";
}

function printPDF(){window.print()}

/* START */
const s=getStudent();
if(!s) location.href="index.html";
studentInfoRender(s);
renderBadges(s);
renderUnitsAndSuggest(s);
renderDone(s);
</script>

</body>
</html>
