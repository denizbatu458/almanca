<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Dersler | Deutsch Lernen</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
:root { --bg1:#1a1022; --bg2:#12081a; --panel:rgba(255,255,255,.08); --border:rgba(255,255,255,.18); --accent:#ff4b4b; --ok:#10b981; --text:#fff; }
body { margin:0; font-family:Inter; background:linear-gradient(180deg, var(--bg1), var(--bg2)); color:var(--text); min-height:100vh; }
.container { max-width:800px; margin:0 auto; padding:40px 20px; }
.lesson-card { background:var(--panel); border:1px solid var(--border); border-radius:24px; padding:30px; margin-bottom:20px; position:relative; }
.lesson-card h2 { margin:0 0 15px 0; display:flex; align-items:center; gap:10px; }
.content-area { line-height:1.6; color:#e0e0e0; font-size:16px; }
.completed-badge { display:none; color:var(--ok); font-weight:bold; margin-top:20px; border-top:1px solid var(--border); padding-top:15px; }
.lesson-card.is-done .completed-badge { display:block; }
</style>
</head>
<body>

<header style="padding:20px; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center;">
    <strong>ðŸ“˜ Almanca Dersleri</strong>
    <button onclick="location.href='index.html'" style="background:none; border:1px solid var(--border); color:#fff; padding:8px 15px; border-radius:10px; cursor:pointer;">Geri DÃ¶n</button>
</header>

<div class="container" id="lessonWrapper">
    </div>

<script>
const LESSONS_KEY = "PRO_DIL_LESSONS";
const SESSION_KEY = "session_student_id";
const LEVELS_KEY = "student_levels";
const DONE_KEY = "practice_done"; // TamamlananlarÄ± buradan takip ediyoruz

function loadLessons() {
    const lessons = JSON.parse(localStorage.getItem(LESSONS_KEY)) || [];
    const sessId = localStorage.getItem(SESSION_KEY);
    const levels = JSON.parse(localStorage.getItem(LEVELS_KEY)) || {};
    const userLevel = levels[sessId] || "A1.1";
    
    // Tamamlanan derslerin listesi
    const doneData = JSON.parse(localStorage.getItem(DONE_KEY)) || {};
    const myDone = doneData[sessId] || [];

    const wrapper = document.getElementById("lessonWrapper");
    
    // Seviyeye gÃ¶re filtrele
    const myLessons = lessons.filter(l => l.level === userLevel);

    if(myLessons.length === 0) {
        wrapper.innerHTML = `<div style="text-align:center; opacity:0.5; margin-top:50px;">Bu seviye iÃ§in henÃ¼z ders iÃ§eriÄŸi eklenmemiÅŸ.</div>`;
        return;
    }

    wrapper.innerHTML = myLessons.map(l => `
        <div class="lesson-card ${myDone.includes(l.id) ? 'is-done' : ''}">
            <h2>${l.icon} ${l.title}</h2>
            <div class="content-area">${l.content}</div>
            <div class="completed-badge">âœ… Bu dersi tamamladÄ±n!</div>
            ${!myDone.includes(l.id) ? `<button onclick="markAsDone('${l.id}')" style="margin-top:20px; width:100%; padding:12px; border-radius:12px; border:none; background:var(--ok); color:#fff; font-weight:bold; cursor:pointer;">Dersi Bitir</button>` : ''}
        </div>
    `).join('');
}

function markAsDone(lessonId) {
    const sessId = localStorage.getItem(SESSION_KEY);
    const doneData = JSON.parse(localStorage.getItem(DONE_KEY)) || {};
    if(!doneData[sessId]) doneData[sessId] = [];
    
    if(!doneData[sessId].includes(lessonId)) {
        doneData[sessId].push(lessonId);
        localStorage.setItem(DONE_KEY, JSON.stringify(doneData));
        alert("Harika! Ä°lerlemen kaydedildi.");
        loadLessons(); // SayfayÄ± gÃ¼ncelle
    }
}

loadLessons();
</script>
</body>
</html>